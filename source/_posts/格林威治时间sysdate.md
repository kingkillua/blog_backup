---
title: 格林威治时间
date: 2016-07-11 18:38:18
tags:
categories: 学
---
quartz定时器一个任务：
每天凌晨1点启动，统计上一个交易日的交易量
小tips：上一个交易日定义其实比较有意思，首先交易日定义是发生交易的日子
所以上一个交易日是找所有交易的日子然后倒排取第二个？
然后发现今天假如没有交易，那上一个交易日其实就是倒排取第一个
那条件判断一下今天有没交易，有就取倒排第二个，没有就取倒排第一个？
简单粗暴没毛病
其实可以直接从昨天开始找有交易的日子然后倒排取第一个，完美解决

---

接着说这次的bug
定时器任务凌晨启动了，但是数据没取到上一个交易日的数据，还是上上一个交易日的
sql放到plsql上执行又能取到上一个交易日的
最后发现sql里面sysdate用的oracle时间，然后前几天灰度服务器停电，配置丢失了
所以用的默认时区格林威治时间，比北京时间慢8个钟
所以凌晨1点定时期执行任务查询数据库的时候，oracle时间还是昨天，sysdate-1自然取的也是前天
233
很蠢的bug，但是挺有趣的哈


